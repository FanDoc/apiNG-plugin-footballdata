/**
    @name: aping-plugin-footballdata 
    @version: 0.1.0 (21-06-2016) 
    @author: Jonathan Hornung 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-footballdata 
    @license: MIT
*/
"use strict";angular.module("jtt_aping_footballdata",["jtt_footballdata"]).directive("apingFootballdata",["apingFootballDataHelper","apingUtilityHelper","footballdataFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingFootballdata,a.getThisPlatformString(),h);i.forEach(function(d){var e={model:h.model};angular.isDefined(h.getNativeData)?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={apiKey:b.getApiCredentials(a.getThisPlatformString(),"api_key")};if(angular.isDefined(d.items)){if(0===d.items||"0"===d.items)return!1;(d.items<0||isNaN(d.items))&&(d.items=void 0)}switch(e.model){case"fbd-team":angular.isDefined(d.teamId)?(f.id=d.teamId,c.getTeam(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))})):angular.isDefined(d.leagueId)&&(f.id=d.leagueId,c.getTeamsBySeason(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))}));break;case"fbd-league":angular.isDefined(d.year)&&("$CURRENT"!==d.year&&(f.season=d.year),c.getSeasons(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))}));break;case"fbd-player":angular.isDefined(d.teamId)&&(f.id=d.teamId,c.getPlayersByTeam(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))}))}})}}}]),angular.module("jtt_aping_footballdata").service("apingFootballDataHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlatformString=function(){return"footballdata"},this.getIdByLinksObject=function(a){var b;if(a&&a.self&&a.self.href){var c=a.self.href.split("/").pop();c.length>0&&(b=c)}return b},this.getObjectByJsonData=function(a,b){var c=[];if(a&&a.data){var d=this,e=[];switch(b.model){case"fbd-team":angular.isDefined(a.data.teams)?e=a.data.teams:e.push(a.data);break;case"fbd-league":e=a.data;break;case"fbd-player":a.data.players&&a.data.players.length>0&&(e=a.data.players);break;case"fbd-table":break;case"fbd-fixtures":}e.constructor===Array&&e.length>0&&angular.forEach(e,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"fbd-team":c=this.getFbdTeamItemByJsonData(a);break;case"fbd-league":c=this.getFbdLeagueItemByJsonData(a);break;case"fbd-player":c=this.getFbdPlayerItemByJsonData(a);break;default:return!1}return c},this.getFbdTeamItemByJsonData=function(b){var c=a.getNew("fbd-team",this.getThisPlatformString());return angular.extend(c,{teamId:b._links?this.getIdByLinksObject(b._links):void 0,code:b.code||void 0,short_name:b.shortName||void 0,name:b.name||void 0,market_value:b.squadMarketValue||void 0,logo_url:b.crestUrl?b.crestUrl.replace("http://","https://"):void 0}),c},this.getFbdLeagueItemByJsonData=function(b){var c=a.getNew("fbd-league",this.getThisPlatformString());return angular.extend(c,{leagueId:b.id||void 0,league:b.league||void 0,caption:b.caption||void 0,currentMatchday:b.currentMatchday||void 0,lastUpdated:b.lastUpdated||void 0,numberOfGames:b.numberOfGames||void 0,numberOfMatchdays:b.numberOfMatchdays||void 0,numberOfTeams:b.numberOfTeams||void 0,year:b.year||void 0}),c},this.getFbdPlayerItemByJsonData=function(b){var c=a.getNew("fbd-player",this.getThisPlatformString());return angular.extend(c,{contractUntil:b.contractUntil||void 0,dateOfBirth:b.dateOfBirth||void 0,jerseyNumber:b.jerseyNumber||void 0,marketValue:b.marketValue||void 0,name:b.name||void 0,nationality:b.nationality||void 0,position:b.position||void 0}),c}}]),angular.module("jtt_footballdata",[]).factory("footballdataFactory",["$http","footballdataSearchDataService",function(a,b){var c={};return c.getSeasons=function(c){var d=b.getNew("getSeasons",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey}})},c.getTeam=function(c){var d=b.getNew("getTeam",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getPlayersByTeam=function(c){var d=b.getNew("getPlayersByTeam",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getFixtures=function(c){var d=b.getNew("getFixtures",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getFixture=function(c){var d=b.getNew("getFixture",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getFixturesByTeam=function(c){var d=b.getNew("getFixturesByTeam",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getTeamsBySeason=function(c){var d=b.getNew("getTeamsBySeason",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getLeagueTableBySeason=function(c){var d=b.getNew("getLeagueTableBySeason",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c.getFixturesBySeason=function(c){var d=b.getNew("getFixturesBySeason",c);return a({method:"GET",url:d.url,params:d.object,headers:{"X-Auth-Token":c.apiKey?c.apiKey:apiKey}})},c}]).service("footballdataSearchDataService",function(){this.getApiBaseUrl=function(){return"http://api.football-data.org/v1/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){angular.isDefined(b[c])&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{},url:""};switch(a){case"getSeasons":c=this.fillDataInObjectByList(c,b,["apiKey","season"]),c.url=this.getApiBaseUrl()+"soccerseasons/";break;case"getTeam":c=this.fillDataInObjectByList(c,b,["apiKey"]),c.url=this.getApiBaseUrl()+"teams/"+b.id;break;case"getPlayersByTeam":c=this.fillDataInObjectByList(c,b,["apiKey"]),c.url=this.getApiBaseUrl()+"teams/"+b.id+"/players";break;case"getFixtures":c=this.fillDataInObjectByList(c,b,["apiKey","league","timeFrame"]),c.url=this.getApiBaseUrl()+"/fixtures";break;case"getFixture":c=this.fillDataInObjectByList(c,b,["apiKey","head2head"]),c.url=this.getApiBaseUrl()+"/fixtures/"+b.id;break;case"getTeamsBySeason":c=this.fillDataInObjectByList(c,b,[]),c.url=this.getApiBaseUrl()+"soccerseasons/"+b.id+"/teams";break;case"getLeagueTableBySeason":c=this.fillDataInObjectByList(c,b,["apiKey","matchday"]),c.url=this.getApiBaseUrl()+"soccerseasons/"+b.id+"/leagueTable";break;case"getFixturesBySeason":c=this.fillDataInObjectByList(c,b,["apiKey","matchday","timeFrame"]),c.url=this.getApiBaseUrl()+"soccerseasons/"+b.id+"/fixtures";break;case"getFixturesByTeam":c=this.fillDataInObjectByList(c,b,["apiKey","season","timeFrame","venue"]),c.url=this.getApiBaseUrl()+"/teams/"+b.id+"/fixtures"}return c}});